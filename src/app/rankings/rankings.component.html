<div class="container">
    <div>
        <h1>Rankings</h1>
        <hr/>
        <div class="row">
            <p>Here are the rankings for week 18! Below are the PPR rankings for this week. To select other rankings, use the menu to the left.</p>
            <p>
                Each week, we dive deep into player performances, injury reports, and upcoming matchups to compile rankings that reflect the true potential of players in the fantasy landscape. 
                Whether it's identifying a sleeper quarterback set to exploit a weak defense or deciding between two running backs with similar production levels,
                our weekly rankings provide invaluable insights to help you dominate the week. 
            </p>
        </div>
        <div class="row mt-2">
            <!-- Search and Filtering -->
            <div class="col-3 d-flex flex-column">
                <label>Player Search</label>
                <input type="text" pInputText placeholder="Search" class="w-100"
                    (input)="filterGlobal($event)" />
                <div class="mt-2">
                    <div>
                        <label>Positions</label>
                    </div>
                    <position-selector [includeKicker]="true" [(selectedPositions)]="selectedPositions" (selectedPositionsChange)="selectedPositionsChange($event)"></position-selector>
                </div>
                <div class="mt-2">
                    <div>
                        <label>Scoring</label>
                    </div>
                    <scoring-selector [scoringParams]="selectedScoringParams" (onScoringParamsChange)="scoringParamsChange($event)"></scoring-selector>
                </div>
            </div>
            <!-- Rankings table -->
            <div class="col-9">
                <ng-container *ngIf="playerRankings.length > 0; else loadingPlayers">
                    <p-table [columns]="rankingsCols" [value]="playerRankings" [tableStyle]="{ 'min-width': '50rem' }" 
                        [paginator]="true"
                        [rows]="50"
                        [showCurrentPageReport]="true"
                        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                        [rowsPerPageOptions]="[25, 50, 100]"
                        dataKey="id"
                        [expandedRowKeys]="keys"
                        #rankingsTable>
                        <ng-template pTemplate="body" let-rowData let-columns="columns" let-expanded="expanded">
                            <tr>
                                <td *ngFor="let col of columns" class="text-center" [hidden]="col.hidden">
                                    @switch (col.field) {
                                        @case ("team.abbreviation") {
                                            {{rowData.team.abbreviation}}
                                        }
                                        @case ("name") {
                                            <div class="d-flex justify-content-start align-items-end">
                                                <img src="../../assets/images/avatars/{{rowData.photo_url}}" class="me-4" style="width: 100px; height: 100px; object-fit: contain;" alt="Player Image">
                                                <span (click)="onItemClick(rowData, rankingsTable)" class="fs-2 text-black clickable-text">
                                                    {{rowData.first_name}} {{rowData.last_name}}
                                                </span>
                                            </div>
                                        }
                                        @default {
                                            {{ rowData[col.field] }}
                                        }
                                    }
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="rowexpansion" let-rowData>
                            <tr>
                                <td [attr.colspan]="rankingsCols.length" class="pb-2">
                                    <label>Weekly Projection: {{rowData.projected_points}} pts</label>
                                    <p>
                                        Wright is our top ranked QB for this week. He's been on fire lately, posting over 300 yards and 2 TDs in each of his last 4 starts.
                                        His Jaguars have a favorable matchup too in the final week of the season. The Colts have given up the 2nd most points to QBs this season,
                                        so it's an easy pick to project Wright to have a great box score on Sunday night.
                                    </p>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </ng-container>
                <ng-template #loadingPlayers>
                    <div class="row mt-3 px-2">
                        <div class="col-2 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                        <div class="col-8">
                            <p-skeleton height="3rem" styleClass="mb-2" borderRadius="16px"></p-skeleton>
                        </div>
                        <div class="col-1 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                        <div class="col-1 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                    </div>
                    <div class="row mt-2 px-2">
                        <div class="col-2 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                        <div class="col-8">
                            <p-skeleton height="3rem" styleClass="mb-2" borderRadius="16px"></p-skeleton>
                        </div>
                        <div class="col-1 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                        <div class="col-1 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                    </div>
                    <div class="row mt-2 px-2">
                        <div class="col-2 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                        <div class="col-8">
                            <p-skeleton height="3rem" styleClass="mb-2" borderRadius="16px"></p-skeleton>
                        </div>
                        <div class="col-1 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                        <div class="col-1 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                    </div>
                    <div class="row mt-2 px-2">
                        <div class="col-2 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                        <div class="col-8">
                            <p-skeleton height="3rem" styleClass="mb-2" borderRadius="16px"></p-skeleton>
                        </div>
                        <div class="col-1 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                        <div class="col-1 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                    </div>
                    <div class="row mt-2 px-2">
                        <div class="col-2 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                        <div class="col-8">
                            <p-skeleton height="3rem" styleClass="mb-2" borderRadius="16px"></p-skeleton>
                        </div>
                        <div class="col-1 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                        <div class="col-1 d-flex justify-content-center">
                            <p-skeleton shape="circle" size="3rem" styleClass="mr-2"></p-skeleton>
                        </div>
                    </div>
                </ng-template>             
            </div>
        </div>
    </div>
</div>